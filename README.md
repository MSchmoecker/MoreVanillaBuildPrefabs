# MoreVanillaBuildPrefabs
MoreVanillaBuildPrefabs is a Valheim mod to make all vanilla prefabs buildable with the hammer (survival way) while allowing you to configure the requirements to build them.

## Acknowledgements
This mod was inspired by MoreVanillaBuilds by Galathil and PotteryBarn by ComfyMods and the core functionality of the code is based on those two mods.

# Instructions
If you are using a mod manager for Thunderstore simply install the mod from there.

If you are not using a mod manager then, you need a modded instance of Valheim (BepInEx) and JÃ¶tunn plugin installed.

1. Download the last MoreVanillaBuilds.dll available in the releases section.
2. Place the MoreVanillaBuilds.dll into your BepInEx\plugins folder
3. You need launch the game first (and enter in a world) to generate the configuration files. The plugin search for prefabs in the game loading screen.
4. (Optional) Stop the game. You found a searica.valheim.morevanillabuildprefabs.cfg in your BepInEx\config folder, open it to customize mod configuration (describe below)
5. Play the game using the default configuration generated by the mod or your customized one.


# Configuration
You need to edit the configuration file with client/server off ! If you use an in-game configuration manager, you need to restart the game/server to apply configuration.

For each detected prefab in the game you can:
- Enable/Disable it from the hammer.
- Define custom recipe to build the prefab in-game.
- Set the required crafting station to build and deconstruct the prefab.
- Set whether the prefab is allowed to be built inside of dungeons.

## _Global Section Configuration:
- EnableMod. Default = true.
  - Globally enable or disable this mod (restart required).
- forceAllPrefabs. Default = false.
  - Setting to true overrides individual configuration for all prefabs and enables them all for building with the hammer.
- verboseMode. Default = false.
  - You should keep it to false. This configuration displays debug information in the console (and slows down game performances)

## Prefab Configuration Sections:
The rest of the configuration files contains [xxxxxx] sections to configure each prefab. Each section contains:

- isEnable = false
  - Change it to true to show the prefab in the hammer. Note that if forceAllPrefabs is set to true, this config is ignored.
- AllowedInDungeons = false
  - Whether the piece can be built inside of dungeons, set to true to allow building it in dungeons.
- Category = CreatorShop
  - This sets tab the prefab should appear. Vanilla categories are: Misc | Crafting | Building | Furniture. This mod adds a fifth category "CreatorShop", see section on CreatorShop pieces.
- CraftingStation =
  - Set the required crafting station. Vanilla crafting station IDs are: piece_workbench | forge | piece_stonecutter | blackforge. Leaving it empty means that it can be built and deconstructed without a crafting station.
- Requirements =
  - The requirements to build the prefab. By default, no requirements needed (like creative mod). Each requirement is separated by a semicolon (;). Each requirement contain the itemID and the quantity separated by a comma (,). You can find itemID on Valheim Wiki or on this link : https://valheim-modding.github.io/Jotunn/data/objects/item-list.html. Example : requirements = Wood,5;Stone,2, in this case you need 5 woods and 2 stones to build the prefab

## Default Prefab Configuration
A number of prefabs have default crafting requirements upon the generation of the configuration file and a subset of those are set to be enabled for building with the hammer. These configurations are based on my liking and trying to ensure that someone playing with the mod will not unlock various build pieces long before they have encountered them in the world. The default configuration also means that the mod can simply be installed and used immediately to get a sense of how it works. You are of course able to change these default configurations however you please.

# Implementation Notes
The prefabs enabled by this mod were not necessarily intended to be built by players, so they may lack some of the things required to place them or build them such as proper collision or snap points.

All of the pieces that are enabled by default have been patched to have snap points or fix collision issues and ensure they can be built with similarly to existing vanilla pieces. While many other prefabs that are not enabled by default have been patched, the process of patching them is currently entirely manual so not all prefabs have been patched. This means that if you enable prefabs other than the ones enabled by default there is no guarantee they will behave nicely.

If you are having issues with a prefab you would like to build with but it won't appear when you try to place it the issue is likely due to missing colliders that have not been patched yet. A work around for some prefabs is to install either [Snap Points Made Easy](https://valheim.thunderstore.io/package/MathiasDecrock/Snap_Points_Made_Easy/)  by MathiasDecrock or the mod [Extra Snap Points Made Easy](https://valheim.thunderstore.io/package/Searica/Extra_Snap_Points_Made_Easy/) by Searica (that's me). Both of these mods allow you to manually select the snap points on the piece you are placing and the piece you are snapping to. Manually selecting the snap points can allow you to place a prefab that otherwise does not show up due to missing colliders.

TLDR: Some prefabs other than the ones enabled by default may be buggy, please adjust your expectations accordingly.

## Deconstructing Pieces
Since this mod adds more prefabs to the hammer, that means you can deconstruct more pieces. Currently the mod is designed so that when you deconstruct world-generate pieces they drop their normal item drops plus some fraction of the additional build resources added to them by this mod (if the prefab is enabled). For pieces that have been built by the player, they will only ever drop the resources used to build them.

## CreatorShop Pieces
If a prefab has been set to the CreatorShop category in the configuration then it will behave slightly differently than pieces from other categories.

Specifically, when a piece is set to the CreatorShop category player's can only deconstruct instances of that piece that they have placed themselves. This prevents player's from deconstructing world-generated prefabs like trees while still allowing you to build and deconstruct player-placed trees. If multiple player's have this mod enabled they can still only deconstruct CreatorShop pieces that they have placed themselves.

# Known Issues
Placing armor on the Male Armor Stand and Female Armor Stand prefabs have clipping issues where not all of the armor is displayed. I have not been able to fix this as of yet.
